# OOAD 책임, 역할, 협력을 이용한 객체지향 설게

프로젝트 구현을 진행하면서, 좀 더 객체지향적이고 구조가 잡힌 코드를 짜고자 개발 블로그를 참고하여 객체지향 설계에 대한 공부를 진행했다.

[galid1님 블로그](https://galid1.tistory.com/681)

</br>

여기에서 객체지향을 설명하기 위해 "영화 예매 시스템"을 예로 들어 개념을 설명하였다.

## 1. 시나리오

영화를 예매할 때는, 어떤 영화를 관람할지. 언제 관람할지. 얼마를 주고 관람할지. 등의 정보를 통해 예매를 하게 된다.

이를 토대로 요구사항을 분석해보자.

### 1.1 요구사항 분석

##### 영화

Movie (제목, 상영시간(러닝타임), 가격 정보 등의 영화에 대한 정보를 담고 있음)

Screening (상영일자(date), 시간, 순번 등의 실제 관람객이 관람하는 사건)

</br>

##### 할인(얼마)

Discount Condition (할인 조건)

- 순서 조건 (상영 순번을 이용한 할인 조건)
- 기간 조건 (상영 시작 시간을 이용한 할인 조건)

Discount Policy (할인 정책)

- 금액 할인 (특정 금액을 할인)
- 비율 할인 (특정 비율을 할인)

</br>

### 1.2 클래스 구조

위의 요구사항을 토대로 클래스 구조를 그려보면 다음과 같은 클래스 구조가 그려진다.

한 번의 예매에는 하나의 스크린을 예매할 수 있고. 여러 번 예매가 가능하다.

하나의 스크린은 하나의 영화를 가지고 있으며 그 영화에는 할인정책이 있을수도 있고, 없을 수도 있다.

만약 할인 정책이 존재한다면, 할인 조건이 존재하게 된다.

![스크린샷 2021-07-29 오후 2.43.25](https://media.oss.navercorp.com/user/25503/files/7be6ba80-f084-11eb-9fcb-f6aa4af0fb42)

</br>

#### * 메시지, 메소드, 다형성

여기서 그럼 왜 이런 구조를 짜게됐는지 짚고 넘어가야 할 필요가 있다.

메시지와 메소드, 다형성을 통해 설명을 할 수 있는데

- 메시지 : 어떤 객체가 수행할 수 있는 책임(행동)을 추상화 한 것
- 메소드 : 메시지를 통해 실제로 실행되는 행동
- 다형성 : 동일한 메시지를 수신했을 때 객체의 타입에 따라 다르게 응답할 수 있는 능력

![스크린샷 2021-07-29 오후 2.53.30](https://media.oss.navercorp.com/user/25503/files/7d17e780-f084-11eb-8f80-ffec2990439e)

위 그림에서 Movie가 Discount Policy에게 할인금액을 계산하라는 메시지를 보냈을 때

이 메시지를 통해 실행되는 메소드는 현재 상황에서는 알 수 없게 된다.

왜냐하면, DiscountPolicy를 상속받는 ***객체*** 가 무엇인지 정해지지 않았기 때문이다. 이 개념이 다형성의 개념이다.

</br>

## 2. 역할, 책임, 협력을 이용한 유연한 설계

### 2.1 협력

객체지향에서는 특정한 책임과 역할을 가진 객체들의 ***협력*** 을 통해 프로그램이 설계 및 구축된다. 

영화 예매라는 도메인을 완성하기 위해 Screening과 Movie 객체는 협력을 하게 된다.

***Screening*** ---- caculateMovieFee(screening) ----> ***Movie***

</br>

여기서 Screening 객체가 Movie 객체에게 caculateMovieFee(영화 요금 계산) 메시지를 보낸 이유는

Movie 객체가 요금 계산을 위한 정보(fee, discountPolicy 등) 를 잘 알고있기 때문이다.

</br>

만약 Screening이 영화 요금을 계산한다고 한다면 Movie의 인스턴스 변수들에 접근해야 할 것이며 이는 Movie의 내부 구현에 Screening이 강하게 결합됨을 의미한다.

즉, Movie 객체의 자율성이 훼손되는 것이다.

객체라는 것은 자신의 상태를 직접 관리하고 스스로의 결정에 따라 행동해야 하는데

Screening에서 영화 요금을 계산하게 되면 Movie는 수동적인 객체가 되는 것이다.

</br>

그래서 객체를 자율적으로 만들기 위해서는 ***캡슐화*** 를 해야 하며 이 자율적인 객체 사용을 위해 적절한 메시지를 전송하면 된다.

</br>

#### 객체의 행동을 결정하는 방법

객체는 상태와 행동을 함께 캡슐화 하는 실행단위 이다.

객체가 가질 상태와 행동은 객체가 참여하는 협력에 따라 달라지게 된다.

</br>

예를 들어, Movie에는 caculateMoviewFee()라는 행동이 존재한다. 이는 영화 예매 시스템이라는 협력에 맞춰 Movie의 행동이 결정된 것이다.

만약, 영화 예매 시스템이라는 협력이 아닌 영화 상영 혹은 관람 시스템이라는 협력이라고 한다면

Movie객체는 Play라는 행동을 가지게 될 것이다.

하지만 영화 예매 시스템에서는 Movie는 단지 영화의 정보만을 나타내는 객체이다.

즉, 어떤 협력인지에 따라 객체의 상태와 행동은 달라지게 된다.

</br>

#### 객체의 상태를 결정하는 방법

객체의 상태를 결정하는 것은 객체의 행동이다. 객체는 자율적인 존재여야 하기 때문에 자신이 가진 행동에 필요한 상태를 가지고 있어야 하기 때문이다.

</br>

### 2.2 책임

앞서 설명한 개념이 ***'협력'*** 이 갖춰졌다고 한다면, 이제는 협력에 필요한 행동을 할 수 있는 적절한 객체를 찾아야 한다.

책임이라는 것은 객체가 유지해야 하는 정보와 행동에 대해 서술한 문장을 말하는데 이는 **하는 것** 과 **아는 것** 으로 구분된다

</br>

영화 예매 시스템에서 Screening의 책임은 영화를 예매하는 것이다.

이는 **하는 것과 관련된 책임**이다.

</br>

또, Screening은 Movie를 알아야만 한다.

이는 **아는 것과 관련된 책임**이다.

</br>

이러한 책임은 협력에 의해 결정된다. 객체에게 할당할 책임을 결정할 문맥을 제공하기 때문이다.

#### 책임할당과 설계과정

우리는 평소에 어떤 도움이 필요할 때에 그 분야의 전문가에게 도움을 요청한다.

객체 역시 협력에서 필요한 행동에 대한 지식과 방법을 잘 알고있는 객체에게 도움을 요청한다.

</br>

따라서 책임할당을 위해서는 먼저 협력 이라는 문맥이 결정되어야 한다.

영화 예매 시스템을 통해 책임을 할당하는 과정을 살펴보자.

</br>![스크린샷 2021-07-29 오후 3.25.06](https://media.oss.navercorp.com/user/25503/files/8dc85d80-f084-11eb-950d-e0c8b7f6acc3)

먼저, 영화를 예매하기 위해서는 **'예매 하라'** 라는 메시지가 필요할 것이다.

그렇다면, 영화를 예매할 책임을 어떤 객체에게 할당해야 좋을까?

바로, 영화를 예매하기 위한 정보를 모두 알고 있는 전문가에게 할당하면 될 것이다.

그 전문가는 Screening 객체가 될 것이다.

왜냐하면 Screening은 영화 예매를 위해 필요한 정보인 상영 시작 시간과 영화 정보를 모두 알고 있기 때문이다.

</br>

![스크린샷 2021-07-29 오후 3.27.39](https://media.oss.navercorp.com/user/25503/files/90c34e00-f084-11eb-926a-bb18653a084d)

하지만 예매를 위해선 가격 정보가 필요한데 Screening은 가격을 계산하는 방법을 알고 있진 않다.

그래서 Screening은 다시 "가격을 계산하라" 라는 새로운 메시지가 필요하게 되며 이 메시지를

가격 계산을 위한 정보를 잘 알고있는 정보 전문가에게 책임을 할당하게 된다.

</br>![스크린샷 2021-07-29 오후 3.28.18](https://media.oss.navercorp.com/user/25503/files/9325a800-f084-11eb-8fb6-a28537cbef38)

그 전문가는 바로 할인 정책, 영화 가격을 알고 있는 Movie 객체가 될 것이다.

![스크린샷 2021-07-29 오후 3.29.44](https://media.oss.navercorp.com/user/25503/files/95880200-f084-11eb-8e07-097fc8348722)



하지만 Movie는 또 할인 요금을 계산 하기 위한 정보전문가가 아니므로

할인 요금을 계산하라는 새로운 메시지가 필요하게 된다.

이렇게 또 다시 해당 전문가에게 책임을 할당하게 된다.

</br>

이처럼 객체지향 설계는 **협력**을 통해 문맥을 결정하고 문맥에 필요한 **메시지**들을 찾고 그 메시지를 처리하는 **책임**을 적절한 객체에게 할당하는 과정을 반복하며 이루어진다.

위 과정에서 우리가 알 수 있는 한 가지 특징은 객체가 메시지를 선택하는 것이 아니라,

**메시지를 통해 적절한 객체를 선택한다는 것**이다.

이렇게 함으로써 필요한 메시지가 나타나기 전까지는 퍼블릭 인터페이스에 어떠한 것도 추가하지 않았기 때문에

꼭 필요한 크기의 인터페이스를 가질 수 있게 된다.

또, 무엇을 하는지는 나타내지만 어떻게 수행하는지는 나타내지 않음으로써 낮은 결합도를 가진 설계가 가능하다.

</br>

### 2.3 역할

객체가 특정한 협력안에서 수행하는 책임의 집합을 ***역할*** 이라고 한다.

위의 예시에서 영화예매 라는 협력안에서, 예매하라 라는 메시지를 처리할 객체로 Screening 을 선택했다.

이 과정은 하나의 과정처럼 보일 수 있지만. 사실 다음과 같은 두 가지 과정이 하나로 합쳐진 것이다.

1. 영화를 예매할 수 있는 적절한 역할을 찾기
2. 해당 역할을 수행할 객체 선택하기



이렇게 역할이라는 개념을 이용하게 되면 과정이 더 늘어나 설계과정이 더 복잡해 보이지만,

역할을 통해 유연하고 재사용 가능한 협력을 얻을 수 있기 때문에 사용하는 것이다.

</br>

예를 들어, "할인 요금을 계산하라" 라는 메시지에 응답할 수 있는 객체는 AmountDiscountPolicy와 PercentDiscountPolicy 가 있다.

그렇다면 이 때, 두 객체가 참여하는 협력을 개별적으로 2개를 만들어야 할까?

만약 두 개의 협력을 만든다면 대부분의 코드가 중복이 될 것이다.

</br>

그렇다면 위와 같은 상황을 책임의 관점에서 바라보자.

AmountDiscountPolicy와 PercentDiscountPolicy 두 객체는 모두 할인 요금을 계산하는 동일한 책임을 수행한다.

따라서 할인 요금을 계산하라 라는 메시지에 응답할 수 있는 대표자를 선출한다면 두 협력을 하나로 통합할 수 있을 것이다.

이러한 대표자를 **'역할'** 이라고 한다.

</br>

![스크린샷 2021-07-29 오후 3.46.11](https://media.oss.navercorp.com/user/25503/files/97ea5c00-f084-11eb-8eef-10613cb7b665)



따라서 이러한 여러 구체적인 객체를 포괄하는 역할에 추상적인 이름을 부여해야 한다.

위 예시에서는 DiscountPolicy가 가장 적절해 보인다.

위 과정의 요점은 동일한 책임을 수행하는 것들을 역할을 기반으로 하나로 통합할 수 있다는 것이다.

</br>

이를 통해 불필요한 코드를 제거할 수 있으며 유연한 협력이 되어,

할인 요금 계산 방법이 달라지더라도 새로운 협력을 추가할 필요가 없어졌다는 것이다.







